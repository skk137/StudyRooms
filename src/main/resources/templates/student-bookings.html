<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Οι Κρατήσεις Μου</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">


<!-- Student Navbar -->
<div th:replace="fragments/navbar-student :: studentNavbar"></div>



<div class="container mt-4">
    <h2 class="mb-4">Οι Κρατήσεις Μου</h2>

    <div class="card shadow-sm">
        <div class="card-body">

            <table class="table table-hover align-middle">
                <thead class="table-dark">
                <tr>
                    <th>Δωμάτιο</th>
                    <th>Ημερομηνία</th>
                    <th>Ώρα</th>
                    <th>Κατάσταση</th>
                    <th class="text-end">Ενέργειες</th>
                </tr>
                </thead>

                <tbody>

                <tr th:each="booking : ${bookings}">

                    <!-- Room -->
                    <td th:text="${booking.room.name}"></td>

                    <!-- Date -->
                    <td th:text="${booking.date}"></td>

                    <!-- Time -->
                    <td>
                        <span th:text="${booking.startTime}"></span>
                        -
                        <span th:text="${booking.endTime}"></span>
                    </td>

                    <!-- Status -->
                    <td>

                        <!-- Checked in -->
                        <span class="badge bg-success"
                              th:if="${booking.checkedin}">
                            Checked-in
                        </span>

                        <!-- Penalty -->
                        <span class="badge bg-danger"
                              th:if="${!booking.checkedin
                                      and booking.date == T(java.time.LocalDate).now()
                                      and booking.endTime < T(java.time.LocalTime).now()}">
                            Penalty
                        </span>

                        <!-- Active -->
                        <span class="badge bg-warning text-dark"
                              th:if="${!booking.checkedin
                                      and !booking.canceled
                                      and (booking.date != T(java.time.LocalDate).now()
                                      or booking.endTime >= T(java.time.LocalTime).now())}">
                            Ενεργή
                        </span>

                        <!-- Canceled -->
                        <span class="badge bg-secondary"
                              th:if="${booking.canceled}">
                            Ακυρωμένη
                        </span>

                    </td>

                    <!-- Actions -->
                    <td class="text-end">

                        <!-- Check-in -->
                        <form th:action="@{/student/bookings/checkin/{id}(id=${booking.id})}"
                              method="post"
                              class="d-inline">

                            <button type="submit"
                                    class="btn btn-success btn-sm"
                                    th:disabled="${booking.checkedin
                                                  or booking.canceled
                                                  or booking.date != T(java.time.LocalDate).now()
                                                  or booking.endTime < T(java.time.LocalTime).now()}">
                                ✔ Check-in
                            </button>
                        </form>

                        <!-- Cancel -->
                        <form th:action="@{/student/bookings/cancel/{id}(id=${booking.id})}"
                              method="post"
                              class="d-inline">

                            <button type="submit"
                                    class="btn btn-danger btn-sm"
                                    th:disabled="${booking.canceled
                                                  or booking.checkedin}">
                                Cancel
                            </button>
                        </form>

                    </td>
                </tr>

                <!-- Empty state -->
                <tr th:if="${#lists.isEmpty(bookings)}">
                    <td colspan="5" class="text-center text-muted">
                        Δεν έχετε κρατήσεις
                    </td>
                </tr>

                </tbody>
            </table>

        </div>
    </div>
</div>

</body>
</html>
